generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id             String         @id @default(cuid())
  name           String
  username       String         @unique
  password       String
  role           String
  isActive       Boolean        @default(true)
  version        Int            @default(1)
  lastLoginAt    DateTime?
  photoUrl       String?
  nif            String?
  iban           String?
  contactPhone   String?
  contactEmail   String?
  emergencyPhone String?
  isTeamMember   Boolean        @default(false)
  teamTitle      String?
  teamBio        String?
  teamCoverPhoto String?
  createdBy      String?
  updatedBy      String?
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  notifications  Notification[]

  @@index([username])
  @@index([role])
  @@index([isActive])
  @@index([isTeamMember])
}

model Category {
  id            String          @id @default(cuid())
  name          String
  icon          String?
  version       Int             @default(1)
  createdBy     String?
  updatedBy     String?
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  equipment     EquipmentItem[]
  subcategories Subcategory[]

  @@index([name])
}

model Subcategory {
  id        String          @id @default(cuid())
  name      String
  parentId  String
  version   Int             @default(1)
  createdBy String?
  updatedBy String?
  createdAt DateTime        @default(now())
  updatedAt DateTime        @updatedAt
  equipment EquipmentItem[]
  category  Category        @relation(fields: [parentId], references: [id], onDelete: Cascade)

  @@index([parentId])
  @@index([name])
}

model EquipmentItem {
  id              String           @id @default(cuid())
  name            String
  description     String
  categoryId      String
  subcategoryId   String?
  quantity        Int
  status          String
  location        String
  imageUrl        String?
  dailyRate       Float            @default(0)
  type            String
  version         Int              @default(1)
  createdBy       String?
  updatedBy       String?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  category        Category         @relation(fields: [categoryId], references: [id])
  subcategory     Subcategory?     @relation(fields: [subcategoryId], references: [id])
  maintenanceLogs MaintenanceLog[]
  quoteItems      QuoteItem[]
  rentals         Rental[]

  @@index([categoryId])
  @@index([subcategoryId])
  @@index([status])
  @@index([type])
  @@index([name])
}

model MaintenanceLog {
  id          String        @id @default(cuid())
  equipmentId String
  date        DateTime
  description String
  cost        Float?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  equipment   EquipmentItem @relation(fields: [equipmentId], references: [id], onDelete: Cascade)
}

model Client {
  id            String   @id @default(cuid())
  name          String
  contactPerson String?
  email         String?
  phone         String?
  address       String?
  notes         String?
  version       Int      @default(1)
  createdBy     String?
  updatedBy     String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  events        Event[]
  quotes        Quote[]

  @@index([name])
  @@index([email])
}

model Event {
  id         String   @id @default(cuid())
  name       String
  clientId   String
  location   String
  startDate  DateTime
  endDate    DateTime
  assignedTo String?
  version    Int      @default(1)
  createdBy  String?
  updatedBy  String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  client     Client   @relation(fields: [clientId], references: [id])
  rentals    Rental[]

  @@index([clientId])
  @@index([startDate])
  @@index([endDate])
  @@index([assignedTo])
}

model Rental {
  id             String        @id @default(cuid())
  eventId        String
  equipmentId    String
  quantityRented Int
  prepStatus     String?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  equipment      EquipmentItem @relation(fields: [equipmentId], references: [id])
  event          Event         @relation(fields: [eventId], references: [id], onDelete: Cascade)
}

model Quote {
  id             String      @id @default(cuid())
  quoteNumber    String      @unique
  name           String
  location       String
  clientId       String?
  clientName     String
  clientEmail    String?
  clientPhone    String?
  clientAddress  String?
  startDate      DateTime
  endDate        DateTime
  subTotal       Float
  discountAmount Float       @default(0)
  discountType   String      @default("fixed")
  taxRate        Float       @default(0)
  taxAmount      Float       @default(0)
  totalAmount    Float
  status         String      @default("Draft")
  notes          String?
  version        Int         @default(1)
  createdBy      String?
  updatedBy      String?
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt
  client         Client?     @relation(fields: [clientId], references: [id])
  items          QuoteItem[]

  @@index([clientId])
  @@index([status])
  @@index([startDate])
  @@index([quoteNumber])
}

model QuoteItem {
  id            String         @id @default(cuid())
  quoteId       String
  type          String
  equipmentId   String?
  equipmentName String?
  serviceId     String?
  serviceName   String?
  feeId         String?
  feeName       String?
  amount        Float?
  feeType       String?
  quantity      Int?
  unitPrice     Float?
  days          Int?
  lineTotal     Float
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  equipment     EquipmentItem? @relation(fields: [equipmentId], references: [id])
  quote         Quote          @relation(fields: [quoteId], references: [id], onDelete: Cascade)
}

model CustomizationSettings {
  id                           String   @id @default(cuid())
  companyName                  String?
  companyTagline               String?
  contactEmail                 String?
  contactPhone                 String?
  useTextLogo                  Boolean  @default(true)
  primaryColor                 String?
  secondaryColor               String?
  accentColor                  String?
  darkMode                     Boolean  @default(false)
  logoUrl                      String?
  faviconUrl                   String?
  loginBackgroundType          String   @default("gradient")
  loginBackgroundColor1        String?
  loginBackgroundColor2        String?
  loginBackgroundImage         String?
  loginCardOpacity             Float    @default(0.95)
  loginCardBlur                Boolean  @default(true)
  loginCardPosition            String   @default("center")
  loginCardWidth               Int      @default(400)
  loginCardBorderRadius        Int      @default(8)
  loginCardShadow              String   @default("large")
  loginLogoUrl                 String?
  loginLogoSize                Int      @default(80)
  loginWelcomeMessage          String?
  loginWelcomeSubtitle         String?
  loginFooterText              String?
  loginShowCompanyName         Boolean  @default(true)
  loginFormSpacing             Int      @default(16)
  loginButtonStyle             String   @default("default")
  loginInputStyle              String   @default("default")
  loginAnimations              Boolean  @default(true)
  loginLightRaysOrigin         String?
  loginLightRaysColor          String?
  loginLightRaysSpeed          Float?
  loginLightRaysSpread         Float?
  loginLightRaysLength         Float?
  loginLightRaysPulsating      Boolean  @default(false)
  loginLightRaysFadeDistance   Float?
  loginLightRaysSaturation     Float?
  loginLightRaysFollowMouse    Boolean  @default(true)
  loginLightRaysMouseInfluence Float?
  loginLightRaysNoiseAmount    Float?
  loginLightRaysDistortion     Float?
  customCSS                    String?
  footerText                   String?
  systemName                   String?
  timezone                     String?
  dateFormat                   String?
  currency                     String?
  language                     String?
  sessionTimeout               Int?
  requireStrongPasswords       Boolean  @default(true)
  enableTwoFactor              Boolean  @default(false)
  maxLoginAttempts             Int?
  emailEnabled                 Boolean  @default(true)
  smtpServer                   String?
  smtpPort                     String?
  smtpUsername                 String?
  smtpPassword                 String?
  fromEmail                    String?
  autoBackup                   Boolean  @default(true)
  backupFrequency              String?
  backupRetention              Int?
  version                      Int      @default(1)
  updatedBy                    String?
  createdAt                    DateTime @default(now())
  updatedAt                    DateTime @updatedAt

  @@map("customization_settings")
}

model UserSession {
  id        String   @id @default(cuid())
  userId    String
  token     String   @unique
  ipAddress String?
  userAgent String?
  expiresAt DateTime
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
  @@index([token])
  @@index([expiresAt])
}

model ActivityLog {
  id         String   @id @default(cuid())
  userId     String?
  action     String
  entityType String?
  entityId   String?
  oldData    String?
  newData    String?
  ipAddress  String?
  userAgent  String?
  createdAt  DateTime @default(now())

  @@index([userId])
  @@index([action])
  @@index([entityType])
  @@index([createdAt])
}

model DataSyncEvent {
  id         String   @id @default(cuid())
  entityType String
  entityId   String
  action     String
  data       String?
  version    Int
  processed  Boolean  @default(false)
  createdAt  DateTime @default(now())

  @@index([entityType])
  @@index([processed])
  @@index([createdAt])
}

model Service {
  id          String   @id @default(cuid())
  name        String
  description String?
  unitPrice   Float
  unit        String   @default("hour")
  category    String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([isActive])
  @@index([category])
}

model Fee {
  id          String   @id @default(cuid())
  name        String
  description String?
  amount      Float
  type        String   @default("fixed")
  category    String?
  isActive    Boolean  @default(true)
  isRequired  Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([isActive])
  @@index([isRequired])
  @@index([category])
}

model Notification {
  id         String   @id @default(cuid())
  userId     String
  type       String
  title      String
  message    String
  priority   String   @default("medium")
  isRead     Boolean  @default(false)
  entityType String?
  entityId   String?
  actionUrl  String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isRead])
  @@index([type])
  @@index([createdAt])
}

model Translation {
  id               String               @id @default(cuid())
  sourceText       String
  targetLang       String
  translatedText   String
  model            String               @default("gemini-2.5-flash")
  createdAt        DateTime             @default(now())
  updatedAt        DateTime             @updatedAt
  category         String               @default("general")
  context          String?
  isAutoTranslated Boolean              @default(false)
  lastUsed         DateTime?
  needsReview      Boolean              @default(false)
  qualityScore     Int                  @default(100)
  reviewedAt       DateTime?
  reviewedBy       String?
  status           String               @default("approved")
  tags             String[]
  usageCount       Int                  @default(0)
  version          Int                  @default(1)
  history          TranslationHistory[]

  @@unique([sourceText, targetLang])
  @@index([sourceText])
  @@index([targetLang])
  @@index([status])
  @@index([category])
  @@index([qualityScore])
  @@index([needsReview])
  @@index([usageCount])
}

model TranslationHistory {
  id                String      @id @default(cuid())
  translationId     String
  oldTranslatedText String
  newTranslatedText String
  changedBy         String?
  changeReason      String?
  version           Int
  createdAt         DateTime    @default(now())
  translation       Translation @relation(fields: [translationId], references: [id], onDelete: Cascade)

  @@index([translationId])
  @@index([version])
  @@index([createdAt])
}
